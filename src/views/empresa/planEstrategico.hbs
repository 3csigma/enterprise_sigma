<!--**********************************
                    Content body start
***********************************-->
<div class="content-body">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12 col-xl-7 col-xxl-7">
                <div class="card avtivity-card"
                    style="background: transparent !important;border: none !important; box-shadow: none !important">
                    <div class="card-body">
                        <h2 style="color: #000; font-weight: bold;">Planifiquemos tus estrategías</h2>
                        <p style="text-align: justify;margin-top: 2em;color: #000">A continuación puedes crear un
                            listado de tareas que te servirán para mejorar tu empresa, a través de las dimensiones:</p>
                        <p style="color: #000; font-weight: bold;">
                            <i class="fa-solid fa-box"></i> Producto ({{dimObj.d1}} tareas)</li></br>
                            <i class="fa-solid fa-user-tie"></i> Administración ({{dimObj.d2}} tareas)</br>
                            <i class="fa-solid fa-gear"></i> Operaciones ({{dimObj.d3}} tareas)</br>
                            <i class="fa-solid fa-bullhorn"></i> Marketing ({{dimObj.d4}} tareas)</br>
                        </p>
                    </div>
                </div>
            </div>

            <div class="col-md-12 col-xl-5 col-xxl-5">
                {{!-- VALIDANDO SI LA EMPRESA ES NUEVA O ESTABLECIDA --}}
                {{#if etapaCompleta.verAnalisis}}
                <div class="card avtivity-card">
                    <div class="card-body">
                        <h2 style="color: #000; font-weight: bold;margin-bottom: 21px;">Rendimiento</h2>
                        <input type="hidden" id="jsonRendimiento" value="{{jsonRendimiento}}">
                        <div class="row">
                            <div class="col-sm-4">
                                <i class="fa fa-square" style="color: #FED061"></i> <span class="small-text">Ventas</span>
                            </div>
                            <div class="col-sm-4">
                                <i class="fa fa-square" style="color: #50368C"></i> <span class="small-text">Compras</span>
                            </div>
                            <div class="col-sm-4">
                                <i class="fa fa-square" style="color: #812082"></i> <span class="small-text">Gastos</span>
                            </div>
                        </div>
                        <br>
                        <br>
                        {{!-- <div id="line_chart_ventas" class="morris_chart_height"></div> --}}
                        <div style="margin-left: -31px;">
                            <div id="multi-line-chart" class="ct-chart ct-golden-section chartlist-chart"></div>
                        </div>
                    </div>
                </div>
                {{/if}}
            </div>
        </div>
        {{!-- Fin de la 1era fila --}}
        {{#if tienePropuesta}}
        <div class="row">
            
            {{!-- TARJETAS LADO DERECHO - CARGA DE ARCHIVOS --}}
            <input type="hidden" id="idEmpresa" value="{{empresa}}">
            <div class="col-xl-5 col-xxl-12">
                {{#if archivos}}
                <div class="row">
                    <div class="col-xl-12">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">Carga de archivos</h4>
                            </div>
            
                            <div class="card-body">
                                <div class="row">
                                    <div class="table-responsive">
                                        <table class="table table-responsive-md text-center">
                                            <thead>
                                                <tr>
                                                    <th>DIMENSIÓN</th>
                                                    <th>DESCRIPCIÓN</th>
                                                    <th>ESTADO</th>
                                                    <th>ACCIÓN</th>
                                                </tr>
                                            </thead>
                                            <tbody>ssss
                                                {{#each archivos}}
                                                <tr>
                                                    <td>{{dimension}}</td>
                                                    <td>{{descripcion}}</td>
                                                    <td><span id="spanEstado{{id}}"
                                                            class="badge light badge-{{color}}">{{estado}}</span></td>
                                                    <td>
                                                        <table border="0" cellspacing="0" style="margin: 0 auto;">
                                                            <tr>
                                                                <td style="border-color: transparent; padding:3px">
                                                                    <label for="inputArchivo{{id}}"
                                                                        onclick="cargarArchivos_Empresa('archivos_estrategico', '{{id}}')">
                                                                        <div class="btn color_primary shadow btn-xs sharp mr-1 text-white"
                                                                            style="border-color: white;">
                                                                            <i class="fa fa-upload"></i>
                                                                        </div>
                                                                    </label>
                                                                    <input id="inputArchivo{{id}}" type="file"
                                                                        style="display:none" />
                                                                </td>
                                                                <td style="border-color: transparent; padding:3px">
                                                                    <a id="btnVer{{id}}" href="{{link}}"
                                                                        style="display: {{display}}; margin: 0 auto; margin-top: -8px; border-color: #FED061"
                                                                        target="_blank"
                                                                        class="btn color_tertiary shadow btn-xs sharp text-white">
                                                                        <i class="fa fa-search"></i></a>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                </tr>
                                                {{/each}}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
            
                            </div>
                        </div>
                    </div>
                </div>
                {{/if}}
            </div>
            {{!-- FIN COLUMNAS - IZQUIERDA DERECHA --}}

            {{!-- TAREAS ASIGNADAS --}}
            <div class="col-xl-12 mt-2">
                <div class="card plan-list">
                    <div class="card-header d-sm-flex flex-wrap d-block pb-0 border-0">
                        <div class="mr-auto pr-3 mb-3">
                            <h4 class="text-black fs-20">Tareas asignadas</h4>
                            <p class="fs-13 mb-0 text-black">Haz clic en una tarea para verla</p>
                        </div>
                        <div class="card-action card-tabs mr-4 mt-3 mt-sm-0 mb-3">
                            <ul class="nav nav-tabs" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link tabs-Task active" data-toggle="tab" href="#Pendientes"
                                        role="tab" aria-selected="true">Pendientes ({{tareas.pendientes.cant}})</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link tabs-Task" data-toggle="tab" href="#EnProceso"
                                        role="tab">En Proceso ({{tareas.enProceso.cant}})</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link tabs-Task" data-toggle="tab" href="#Completadas"
                                        role="tab">Completadas ({{tareas.completadas.cant}})</a>
                                </li>
                                {{!-- <li class="nav-item">
                                    <a class="nav-link tabs-Task" data-toggle="tab" href="#Todas" role="tab"
                                        aria-selected="false">Todas</a>
                                </li> --}}
                            </ul>
                        </div>

                    </div>

                    <div class="card-body tab-content pt-2">
                        {{!-- TAREAS PENDIENTES --}}
                        <div class="tab-pane active show fade" id="Pendientes">
                            {{#if tareas.pendientes}}
                            {{#each tareas.pendientes}}
                            <div class="d-flex border-bottom flex-wrap pt-3 list-row align-items-center mb-2">
                                <div class="col-xl-5 col-xxl-6 col-lg-6 col-sm-8 d-flex align-items-center">
                                    <div class="list-icon bgl-primary mr-3 mb-3">
                                        <p class="fs-24 text-secondary mb-0 mt-2">{{dia}}</p>
                                        <span class="fs-14 text-secondary">{{mes}}</span>
                                    </div>
                                    <div class="info mb-3">
                                        <h4 onclick="mostrarTarea({{id}})" class="fs-20"><span
                                                class="text-black">{{actividad}}</span></h4>
                                        <span class="text-{{color}} font-w600">{{estado}}</span>
                                        {{!-- TIEMPO --}}
                                        <span class="badge light color_gradient text-white"
                                            style="padding: 4px 14px; padding-left: 7px;">
                                            <i class="fa-regular fa-clock pr-2"></i> {{tiempo}}</span>
                                        {{!-- PRIORIDAD  --}}
                                        <span>Prioridad: {{prioridad}}</span>
                                    </div>
                                </div>
                                <div
                                    class="col-xl-3 col-xxl-4 col-lg-3 col-sm-5 activities mb-3 mr-auto pl-3 pr-3 text-sm-center">
                                    <i class="fa-solid {{icono}}"></i>
                                    <span class="text-gray ml-2">{{dimension}}</span>
                                </div>
                                <div class="col-xl-4 col-xxl-2 col-lg-3 col-sm-12 d-flex align-items-center">
                                    <a onclick="mostrarTarea({{id}})" class="btn mb-3 play-button rounded mr-3">
                                        <i class="fa-regular fa-eye"></i> Ver Detalles
                                    </a>
                                </div>
                            </div>
                            {{/each}}
                            {{else}}
                            <div class="card-body px-0"
                                style=" display: flex; justify-content: center; align-items: center;">
                                <label style="font-size:22px;color:#000;font-weight:600;margin-bottom: 20px;">No
                                    hay tareas pendientes</label>
                            </div>
                            {{/if}}
                        </div>

                        {{!-- TAREAS EN PROCESO --}}
                        <div class="tab-pane fade" id="EnProceso">
                            {{#if tareas.enProceso}}
                            {{#each tareas.enProceso}}
                            <div class="d-flex border-bottom flex-wrap pt-3 list-row align-items-center mb-2">
                                <div class="col-xl-5 col-xxl-8 col-lg-6 col-sm-8 d-flex align-items-center">
                                    <div class="list-icon bgl-primary mr-3 mb-3">
                                        <p class="fs-24 text-secondary mb-0 mt-2">{{dia}}</p>
                                        <span class="fs-14 text-secondary">{{mes}}</span>
                                    </div>
                                    <div class="info mb-3">
                                        <h4 onclick="mostrarTarea({{id}})" class="fs-20"><span
                                                class="text-black">{{actividad}}</span></h4>
                                        <span class="text-{{color}} font-w600">{{estado}}</span>
                                        {{!-- TIEMPO --}}
                                        <span class="badge light badge-success color_gradient text-white"
                                            style="padding: 4px 14px; padding-left: 7px;"><i
                                                class="fa-regular fa-clock pr-2"></i> {{tiempo}}</span>
                                        {{!-- PRIORIDAD  --}}
                                        <span>Prioridad: {{prioridad}}</span>
                                    </div>
                                </div>
                                <div
                                    class="col-xl-3 col-xxl-5 col-lg-3 col-sm-5 activities mb-3 mr-auto pl-3 pr-3 text-sm-center">
                                    <i class="fa-solid {{icono}}"></i>
                                    <span class="text-gray ml-2">{{dimension}}</span>
                                </div>
                                <div class="col-xl-4 col-xxl-12 col-lg-3 col-sm-12 d-flex align-items-center">
                                    <a onclick="mostrarTarea({{id}})" class="btn mb-3 play-button rounded mr-3">
                                        <i class="fa-regular fa-eye"></i> Ver Detalles
                                    </a>
                                </div>
                            </div>
                            {{/each}}
                            {{else}}
                            <div class="card-body px-0"
                                style=" display: flex; justify-content: center; align-items: center;">
                                <label style="font-size:22px;color:#000;font-weight:600;margin-bottom: 20px;">No
                                    hay tareas en proceso</label>
                            </div>
                            {{/if}}
                        </div>

                        {{!-- TAREAS COMPLETADAS --}}
                        <div class="tab-pane fade" id="Completadas">
                            {{#if tareas.completadas}}
                            {{#each tareas.completadas}}
                            <div class="d-flex border-bottom flex-wrap pt-3 list-row align-items-center mb-2">
                                <div class="col-xl-5 col-xxl-8 col-lg-6 col-sm-8 d-flex align-items-center">
                                    <div class="list-icon bgl-primary mr-3 mb-3">
                                        <p class="fs-24 text-secondary mb-0 mt-2">{{dia}}</p>
                                        <span class="fs-14 text-secondary">{{mes}}</span>
                                    </div>
                                    <div class="info mb-3">
                                        <h4 onclick="mostrarTarea({{id}})" class="fs-20"><span
                                                class="text-black">{{actividad}}</span></h4>
                                        <span class="text-{{color}} font-w600">{{estado}}</span>
                                    </div>
                                </div>
                                <div
                                    class="col-xl-3 col-xxl-5 col-lg-3 col-sm-5 activities mb-3 mr-auto pl-3 pr-3 text-sm-center">
                                    <i class="fa-solid {{icono}}"></i>
                                    <span class="text-gray ml-2">{{dimension}}</span>
                                </div>
                                <div class="col-xl-4 col-xxl-12 col-lg-3 col-sm-12 d-flex align-items-center">
                                    <a onclick="mostrarTarea({{id}})" class="btn mb-3 play-button rounded mr-3">
                                        <i class="fa-regular fa-eye"></i> Ver Detalles
                                    </a>
                                </div>
                            </div>
                            {{/each}}
                            {{else}}
                            <div class="card-body px-0"
                                style=" display: flex; justify-content: center; align-items: center;">
                                <label
                                    style="font-size:22px;color:#000;font-weight:600;margin-bottom: 20px;">Aún
                                    no hay tareas completadas</label>
                            </div>
                            {{/if}}
                        </div>

                        {{!-- TODAS LAS TAREAS --}}
                        <div class="tab-pane fade" id="Todas">
                            {{#each tareas.todas}}
                            <div class="d-flex border-bottom flex-wrap pt-3 list-row align-items-center mb-2">
                                <div class="col-xl-5 col-xxl-8 col-lg-6 col-sm-8 d-flex align-items-center">
                                    <div class="list-icon bgl-primary mr-3 mb-3">
                                        <p class="fs-24 text-secondary mb-0 mt-2">{{dia}}</p>
                                        <span class="fs-14 text-secondary">{{mes}}</span>
                                    </div>
                                    <div class="info mb-3">
                                        <h4 onclick="mostrarTarea({{id}})" class="fs-20"><span
                                                class="text-black">{{actividad}}</span></h4>
                                        <span class="text-{{color}} font-w600">{{estado}}</span>
                                        {{!-- TIEMPO --}}
                                        {{#unless tareaOk}}
                                        <span class="badge light badge-success color_gradient text-white"
                                            style="padding: 4px 14px; padding-left: 7px;"><i
                                                class="fa-regular fa-clock pr-2"></i> {{tiempo}}</span>
                                        {{!-- PRIORIDAD --}}
                                        <span class="badge light badge-success">Prioridad: {{prioridad}}</span>
                                        {{/unless}}
                                    </div>
                                </div>
                                <div
                                    class="col-xl-3 col-xxl-5 col-lg-3 col-sm-5 activities mb-3 mr-auto pl-3 pr-3 text-sm-center">
                                    <i class="fa-solid {{icono}}"></i>
                                    <span class="text-gray ml-2">{{dimension}}</span>
                                </div>
                                <div class="col-xl-4 col-xxl-12 col-lg-3 col-sm-12 d-flex align-items-center">
                                    <a onclick="mostrarTarea({{id}})" class="btn mb-3 play-button rounded mr-3">
                                        <i class="fa-regular fa-eye"></i> Ver Detalles
                                    </a>
                                </div>
                            </div>
                            {{/each}}
                        </div>
                    </div>

                </div>
            </div>

        </div>
        {{/if}}

    </div>
</div>

{{> general/mostrarTarea}}
{{> general/sidebarTareas}}

<!--**********************************
            Scripts
***********************************-->
<script src="https://code.jquery.com/jquery-3.6.1.js"></script>
<script src="../vendor/js/chartist.min.js"></script>
<script src="../vendor/js/chartist-plugin-tooltip.min.js"></script>

<script>
    (function($) {

        const dzChartlist = function(){
            const screenWidth = $(window).width();
                
            const setChartWidth = function(){
                
                if(screenWidth <= 768)
                {
                    const chartBlockWidth = 0;
                    if(screenWidth >= 500)
                    {
                        chartBlockWidth = 250;
                    }else{
                        chartBlockWidth = 300;
                    }
                    
                    jQuery('.chartlist-chart').css('min-width',chartBlockWidth - 31);
                }
            }
            
            const multiLineChart = (fechas, datos) => {
                //Multi-line labels
                new Chartist.Bar('#multi-line-chart', {
                    labels: fechas,
                    series: datos,
                }, {
                    seriesBarDistance: 10,
                    axisX: { offset: 60 },
                    axisY: {
                        offset: 80,
                        labelInterpolationFnc: function(value) {
                            return '$' + value
                        },
                        scaleMinSpace: 15
                    },
                    plugins: [Chartist.plugins.tooltip()],
                    classNames: {
                        chart: 'ct-chart-bar',
                        horizontalBars: 'ct-horizontal-bars',
                        label: 'ct-label',
                        labelGroup: 'ct-labels',
                        series: 'ct-series',
                        bar: 'ct-bar',
                        grid: 'ct-grid',
                        gridGroup: 'ct-grids',
                        gridBackground: 'ct-grid-background',
                        vertical: 'ct-vertical',
                        horizontal: 'ct-horizontal',
                        start: 'ct-start',
                        end: 'ct-end'
                    }
                });
            }

            /* Function ============ */
                return {
                    init:function(){
                    },
                    
                    load:function(){
                        
                        /** Gráfica de Rendimiento para Empresas */
                        let matriz = new Array(), fechas = [];
                        let dataEmpresa = document.querySelector('#jsonRendimiento').value
                        dataEmpresa = JSON.parse(dataEmpresa)
                        if (dataEmpresa.length > 0) {
                            for(let i=0;i<dataEmpresa.length; i++){
                                matriz[i] = new Array();
                                fechas.push(dataEmpresa[i].fecha)
                                for(let j=0;j<3; j++){
                                    if(j == 0){
                                        matriz[i][j] = dataEmpresa[i].total_ventas                                    
                                    }  else if(j == 1){
                                        matriz[i][j] = dataEmpresa[i].total_compras                                    
                                    }else if(j == 2){
                                        matriz[i][j] = dataEmpresa[i].total_gastos    
                                    }
                                }
                            }
                        // TRANPONER MATRIZ (Ej: de 3 COLUMNAS a 2)
                        let arrayT = matriz[0].map((_, colIndex) => matriz.map(x => x[colIndex]));
                        multiLineChart(fechas, arrayT) 
                        }
                    }
                }
        }();

        jQuery(document).ready(function(){
            {{#unless tutoriales.etapa}}
            //POPUP CON TUTORIAL
            Swal.fire({
            title: '<strong>HTML <u>example</u></strong>',
            icon: 'info',
            html: 'You can use <b>bold text</b>, ' +
                '<a href="//sweetalert2.github.io">links</a> ' +
                'and other HTML tags',
            showCloseButton: true,
            showCancelButton: true,
            focusConfirm: false,
            confirmButtonText: '<i class="fa fa-thumbs-up"></i> Great!',
            confirmButtonAriaLabel: 'Thumbs up, great!',
            cancelButtonText: '<i class="fa fa-thumbs-down"></i>',
            cancelButtonAriaLabel: 'Thumbs down'
            })
            {{/unless}}

            $("#close-sidebar-estrategico").on("click", () => {
                $("#sidebarEstrategico").removeClass("active")
                // PLAN ESTRATÉGICO
                $('#cuerpoGeneral').css('overflow-y', 'auto')
                $('#fechaIni-sidebar2').css('display', 'inline-block')
                $('#fechaFin-sidebar2').css('display', 'inline-block')
                $('#dimension-sidebar2').css('display', 'inline-block')
                $('#btnGuardar-sidebar2').css('display', 'flex')
                $("#estado2").css('display', 'inline-block')
                $('#actividad-sidebar2').attr('readonly', false)
                $("#responsable2").attr({'readonly': false, 'placeholder': 'Escribe un título..'})
                $("#descripcion-sidebar2").attr({'readonly': false, 'placeholder': 'Escribe una descripción detallada u observación para esta tarea..'})
                $('#txtFechaIni2').css('display', 'none')
                $('#txtFechaFin2').css('display', 'none')
                $('#txtDimension2').css('display', 'none')
                $('#estado-sidebar2').css('display', 'none')
            })
        });
            
        jQuery(window).on('load',function(){
            dzChartlist.load();
        });

        jQuery(window).on('resize',function(){
        });     

    })(jQuery);
</script>