<style>
.default-tab .nav-link:focus, .default-tab .nav-link:hover, .default-tab .nav-link.active {
    color: #495057 !important;
    background-color: #fff !important;
    border-color: #dee2e6 #dee2e6 #fff #ebeef6 !important;
    border-radius: 1.25rem 1.25rem 0 0 !important;
}
.nav-tabs .nav-item .nav-link:before, .nav-tabs .nav-item .nav-link.active:before {
    height: 3px;
    background-color: transparent;
}
.nav-tabs .nav-link {
    border: 1px solid transparent !important;
    border-top-left-radius: 0.75rem !important;
    border-top-right-radius: 0.75rem !important;
}
</style>
<!--**********************************
        Content body start
***********************************-->
<div class="content-body">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header border-0">
                        <h1 class="text-black two-line-text">Módulos educativos</h1>
                        <a href="/crear-modulos" class="btn color_gradient text-white"><i class="fa fa-plus"></i> Nuevo</a>
                    </div>
                    <div class="card-body default-tab">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="tab" href="#cursos" style="padding: 0.5rem 1rem !important;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="14" viewBox="0 0 20 14" fill="none">
                                        <path d="M10.0002 0C9.74712 0 9.49713 0.0437414 9.25963 0.1281L0.494219 3.2931C0.197351 3.40246 0.000480997 3.68365 0.000480997 3.99922C0.000480997 4.31478 0.197351 4.59597 0.494219 4.70533L2.30355 5.35833C1.79106 6.16442 1.50045 7.11736 1.50045 8.12028V8.99824C1.50045 9.88556 1.16295 10.801 0.803587 11.5227C0.600467 11.9289 0.369222 12.3288 0.100479 12.6975C0.000480998 12.8319 -0.0276433 13.0068 0.0286053 13.1662C0.084854 13.3255 0.216101 13.4442 0.378597 13.4849L2.37855 13.9848C2.5098 14.0191 2.65042 13.9941 2.76604 13.9223C2.88166 13.8504 2.96291 13.7317 2.98791 13.5973C3.25665 12.2601 3.12228 11.0603 2.92229 10.2011C2.82229 9.75746 2.68792 9.30443 2.50042 8.88888V8.12028C2.50042 7.17672 2.81916 6.28627 3.37227 5.57391C3.77539 5.08963 4.29725 4.69908 4.90974 4.4585L9.81587 2.53075C10.0721 2.43077 10.3627 2.55575 10.4627 2.81195C10.5627 3.06815 10.4377 3.35872 10.1815 3.4587L5.27535 5.38644C4.88786 5.53954 4.54725 5.77387 4.26913 6.06131L9.25651 7.86096C9.494 7.94532 9.744 7.98906 9.99712 7.98906C10.2502 7.98906 10.5002 7.94532 10.7377 7.86096L19.5063 4.70533C19.8031 4.5991 20 4.31478 20 3.99922C20 3.68365 19.8031 3.40246 19.5063 3.2931L10.7408 0.1281C10.5034 0.0437414 10.2534 0 10.0002 0ZM4.00038 11.7477C4.00038 12.8506 6.68782 13.9973 10.0002 13.9973C13.3127 13.9973 16.0001 12.8506 16.0001 11.7477L15.522 7.20484L11.0783 8.81077C10.7315 8.93575 10.3659 8.99824 10.0002 8.99824C9.63462 8.99824 9.26588 8.93575 8.92214 8.81077L4.4785 7.20484L4.00038 11.7477Z" fill="#812082"/>
                                    </svg> <span class="text-primary">Cursos</span></a>
                            </li>
                            {{!-- <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#profile"><i class="la la-user mr-2"></i> Profile</a>
                            </li> --}}
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="cursos" role="tabpanel">
                                <div class="table-responsive mt-4">
                                    <table id="example3" class="display min-w850" style="width: 100%">
                                        <thead>
                                            <tr>
                                                <th>THUMBNAIL</th>
                                                <th>MÓDULO</th>
                                                <th>CURSO</th>
                                                <th>LECCIONES</th>
                                                <th>PROGRAMA</th>
                                                <th>ESTADO</th>
                                                <th>ACCIÓN</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {{#each modulos}}
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center"><img src="{{miniatura}}"
                                                            class="rounded-lg mr-2" width="112" alt="" /></div>
                                                </td>
                                                <td>{{nombre}}</td>
                                                <td>
                                                    <a href="#" onclick="editCategory('{{categoria}}')" data-toggle="modal" data-target="#modal_editCategory" class="text-black">
                                                        {{categoria}}
                                                    </a>
                                                </td>
                                                <td>{{numLecciones}} Lecciones</td>
                                                <td>{{programas}}</td>
                                                <td>
                                                    <div class="d-flex align-items-center"><i
                                                            class="fa fa-circle {{color}} mr-1"></i>{{estado}}</div>
                                                </td>
                                                <td>
                                                    <div style="margin: 0 auto">
                                                        <!-- Ver Módulo -->
                                                        <a href="/ver-modulos/{{codigo}}"class="btn btn-warning shadow btn-xs sharp mr-1 text-white"><i class="fa fa-eye"></i></a>
                                                        <!-- Editar Módulo -->
                                                        <a href="/editar-modulo/{{codigo}}"
                                                            class="btn color_gradient shadow btn-xs sharp mr-1 text-white"><i
                                                                class="fa fa-pencil"></i></a>
                                                        <!-- Eliminar Módulo -->
                                                        <a onclick="eliminarModulos({{id}})" class="btn btn-danger shadow btn-xs sharp text-white"><i class="fa fa-trash"></i></a>
                                                    </div>
                                                </td>
                                            </tr>
                                            {{/each}}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MODAL EDITAR CATEGORÍA -->
<div class="modal fade" id="modal_editCategory">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Actualizar curso</h5>
                <button type="button" class="close" data-dismiss="modal"><span>×</span>
                </button>
            </div>
            <form action="/updateCategory" method="post">
                <div class="modal-body">
                    <div class="form-group col-md-12 pt-2">
                        <input type="text" name="categoria_actual" id="categoria_actual" class="form-control" style="display: none">
                        <label class="text-black" id="txtCateActual"></label>
                        <hr>
                        <label>Nuevo nombre</label>
                        <input type="text" name="categoria" class="form-control required" required placeholder="Escribe el nuevo nombre del curso.." style="border: 1px solid #c6c6c6;">
                    </div>
                </div>
                <div class="modal-footer">
                    {{!-- <button type="button" class="btn color_gradient text-white" data-dismiss="modal">Cerrar</button> --}}
                    <button type="submit" class="btn color_gradient text-white">Actualizar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // ACTUALIZAR CATEGORÍAS (CURSOS)
    function editCategory(nombre) {
        console.log("Categoría a editar: ", nombre)
        const cate = $('#txtCateActual')
        cate.css({
            'font-size': '20px',
            'font-weight': 'bold',
        });
        $('#categoria_actual').val(nombre);
        cate.text(nombre);
        
    }

    //   ELIMINANDO MODULOS CREADOS
    function eliminarModulos(id) {
        Swal.fire({
            title: '¿Seguro que deseas eliminar este modulo?',
            text: "Esta acción no se puede deshacer.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#50368C',
            cancelButtonColor: '#d33',
            cancelButtonText: 'Cancelar',
            confirmButtonText: '¡Sí, Borrar!'
        })
            .then((result) => {
                if (result.isConfirmed) {
                    fetch('/eliminar-modulo', {
                        method: 'POST',
                        body: JSON.stringify({ id }),
                        headers: { 'Content-Type': 'application/json' }
                    }).then(res => res.json())
                        .catch(error => console.error('Error:', error))
                        .then(response => {
                            if (response) {
                                location.reload();
                            } else {
                                Swal.fire(
                                    'Error!',
                                    'Error al borrar el modulo.',
                                    'error'
                                )
                            }
                        });
                }
            })
    }
</script>